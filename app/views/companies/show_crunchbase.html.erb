<%- model_class = Company -%>
<div class="page-header">
  <h3><%=t '.title', :default => "#{@company.name} - Crunchbase" %></h3>
</div>

<%# @crunchbase_company.methods - Object.methods %>

<table class="table">
  <% if @crunchbase_company.respond_to?("twitter_username") %>
  <tr>
    <td><strong>Twitter</strong></td>
    <td><%= link_to "@#{@crunchbase_company.twitter_username}", "http://www.twitter.com/#{@crunchbase_company.twitter_username}" %></td>
  </tr>
  <% end %>

  <% crunchbase_attributes.each do |attribute| %>
    <% if @crunchbase_company.respond_to?(attribute.to_s) && @crunchbase_company.send(attribute.to_s) %>
      <% attribute_value = @crunchbase_company.send(attribute.to_s) %>
      <tr>
        <td><strong><%= model_class.human_attribute_name(attribute) %>:</strong></td>
        <td>
          <% if attribute_value.is_a? String %>
            <%= auto_link(attribute_value, :all, :target => "_blank") %>
          <% else %>
            <%= attribute_value %>
          <% end %>
        </td>
      </tr>
    <% end %>
  <% end %>
  
  <% if @crunchbase_company.respond_to?("funding_rounds") %>
  <tr>
    <td><strong>Funding Rounds</strong></td>
    <td>
      <%# @crunchbase_company.funding_rounds %>
      <% @crunchbase_company.funding_rounds.each do |round| %>
        <p>
          <% round_name = round['round_code'] == "seed"  ?  round['round_code'].capitalize  :  "Series " + round['round_code'].capitalize %>
          <% amount = round["raised_amount"].to_i > 1e6  ?  "#{round["raised_amount"].to_i / 1e6}M"  :  "#{round["raised_amount"].to_i / 1e3}K" %>
          <strong><%= link_to "#{round_name}, #{round['funded_month']}/#{round['funded_year']} ", round['source_url'] %></strong><br>
          <strong><%= amount %> <%= round["raised_currency_code"] %></strong>
          <ul>
          <% round["investments"].each do |investment| %>
            <li>
              <% if investment["company"] %>
                <% name = investment["company"]["name"] %>
              <% elsif investment["financial_org"] %>
                <% name = investment["financial_org"]["name"] %>
              <% elsif investment["person"] %>
                <% name = "#{investment["person"]["first_name"]} #{investment["person"]["last_name"]}" %>
              <% end %>
              <%= link_to name, "http://www.google.com/search?q=#{name.gsub(' ','+')}" %>
            </li>
          <% end %>
          </ul>
        </p>
      <% end %>
    </td>
  </tr>
  <% end %>
  
  <% if @crunchbase_company.respond_to?("overview") %>
  <tr>
    <td><strong>Overview</strong></td>
    <td><%= simple_format @crunchbase_company.overview %></td>
  </tr>
  <% end %>
<table>

